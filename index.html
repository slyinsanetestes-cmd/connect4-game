<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background: #000; 
            color: #0f0; 
            font-family: monospace; 
            padding: 20px;
        }
        button { 
            background: #0f0; 
            color: #000; 
            border: none; 
            padding: 15px; 
            margin: 10px; 
            font-size: 16px; 
            cursor: pointer;
        }
        .log { 
            background: #111; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #0f0;
        }
    </style>
</head>
<body>
    <h1>üß™ TESTE WEB APP</h1>
    
    <div id="status">Carregando...</div>
    
    <div>
        <button onclick="testSend('join_room', {room_id: 'free'})">
            üéÆ ENVIAR join_room
        </button>
        
        <button onclick="testSend('profile', {})">
            üìä ENVIAR profile
        </button>
        
        <button onclick="testSend('test', {hello: 'world'})">
            üß™ ENVIAR teste
        </button>
    </div>
    
    <div class="log" id="log">
        <!-- Logs aparecer√£o aqui -->
    </div>

    <script>
        // Telegram Web App
        const tg = window.Telegram.WebApp;
        
        // Expande e inicializa
        tg.expand();
        tg.ready();
        
        // Elementos DOM
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('log');
        
        // Fun√ß√£o de log
        function log(msg) {
            console.log(msg);
            logEl.innerHTML += msg + '<br>';
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        // Inicializa√ß√£o
        log("=== WEB APP INICIADO ===");
        log(`Plataforma: ${tg.platform}`);
        log(`Vers√£o: ${tg.version}`);
        log(`User ID: ${tg.initDataUnsafe?.user?.id || 'N/A'}`);
        log(`User: ${tg.initDataUnsafe?.user?.first_name || 'N/A'}`);
        
        statusEl.innerHTML = `üë§ ${tg.initDataUnsafe?.user?.first_name || 'Usu√°rio'} | ID: ${tg.initDataUnsafe?.user?.id || 'N/A'}`;
        
        // Fun√ß√£o para enviar dados
        function testSend(action, data) {
            const payload = {
                action: action,
                user_id: tg.initDataUnsafe?.user?.id,
                username: tg.initDataUnsafe?.user?.first_name || "Teste",
                timestamp: Date.now(),
                ...data
            };
            
            log(`üì§ Enviando: ${JSON.stringify(payload)}`);
            
            try {
                // M√©todo 1: sendData padr√£o
                tg.sendData(JSON.stringify(payload));
                log("‚úÖ sendData() chamado");
                
                // M√©todo 2: Feedback
                tg.showAlert(`Enviado: ${action}`);
                
                // M√©todo 3: Tentar enviar como callback
                setTimeout(() => {
                    try {
                        if (window.TelegramGameProxy && window.TelegramGameProxy.receiveEvent) {
                            window.TelegramGameProxy.receiveEvent("custom", JSON.stringify(payload));
                            log("‚úÖ TelegramGameProxy usado");
                        }
                    } catch (e) {
                        log(`‚ùå TelegramGameProxy: ${e.message}`);
                    }
                }, 100);
                
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`);
            }
        }
        
        // Event listeners
        tg.onEvent('themeChanged', () => {
            log("üé® Tema alterado");
        });
        
        tg.onEvent('viewportChanged', (e) => {
            log(`üì± Viewport: ${JSON.stringify(e)}`);
        });
        
        // Teste autom√°tico ap√≥s 2 segundos
        setTimeout(() => {
            log("‚è∞ Teste autom√°tico iniciando...");
            testSend('autotest', {test: true});
        }, 2000);
        
        // Mostra todos os m√©todos dispon√≠veis
        log("=== M√âTODOS DISPON√çVEIS ===");
        log(`tg.sendData: ${typeof tg.sendData}`);
        log(`tg.showAlert: ${typeof tg.showAlert}`);
        log(`tg.platform: ${tg.platform}`);
        
        // Verifica GameProxy
        if (window.TelegramGameProxy) {
            log("‚úÖ TelegramGameProxy dispon√≠vel");
            log(`M√©todos: ${Object.keys(window.TelegramGameProxy)}`);
        } else {
            log("‚ùå TelegramGameProxy N√ÉO dispon√≠vel");
        }
    </script>
</body>
</html>
